{"ast":null,"code":"var common = require('./common');\n\nvar os = require('os');\n\nvar fs = require('fs');\n\ncommon.register('tempdir', _tempDir, {\n  allowGlobbing: false,\n  wrapOutput: false\n}); // Returns false if 'dir' is not a writeable directory, 'dir' otherwise\n\nfunction writeableDir(dir) {\n  if (!dir || !fs.existsSync(dir)) return false;\n  if (!common.statFollowLinks(dir).isDirectory()) return false;\n  var testFile = dir + '/' + common.randomFileName();\n\n  try {\n    fs.writeFileSync(testFile, ' ');\n    common.unlinkSync(testFile);\n    return dir;\n  } catch (e) {\n    /* istanbul ignore next */\n    return false;\n  }\n} // Variable to cache the tempdir value for successive lookups.\n\n\nvar cachedTempDir; //@\n//@ ### tempdir()\n//@\n//@ Examples:\n//@\n//@ ```javascript\n//@ var tmp = tempdir(); // \"/tmp\" for most *nix platforms\n//@ ```\n//@\n//@ Searches and returns string containing a writeable, platform-dependent temporary directory.\n//@ Follows Python's [tempfile algorithm](http://docs.python.org/library/tempfile.html#tempfile.tempdir).\n\nfunction _tempDir() {\n  if (cachedTempDir) return cachedTempDir;\n  cachedTempDir = writeableDir(os.tmpdir()) || writeableDir(process.env.TMPDIR) || writeableDir(process.env.TEMP) || writeableDir(process.env.TMP) || writeableDir(process.env.Wimp$ScrapDir) || // RiscOS\n  writeableDir('C:\\\\TEMP') || // Windows\n  writeableDir('C:\\\\TMP') || // Windows\n  writeableDir('\\\\TEMP') || // Windows\n  writeableDir('\\\\TMP') || // Windows\n  writeableDir('/tmp') || writeableDir('/var/tmp') || writeableDir('/usr/tmp') || writeableDir('.'); // last resort\n\n  return cachedTempDir;\n} // Indicates if the tempdir value is currently cached. This is exposed for tests\n// only. The return value should only be tested for truthiness.\n\n\nfunction isCached() {\n  return cachedTempDir;\n} // Clears the cached tempDir value, if one is cached. This is exposed for tests\n// only.\n\n\nfunction clearCache() {\n  cachedTempDir = undefined;\n}\n\nmodule.exports.tempDir = _tempDir;\nmodule.exports.isCached = isCached;\nmodule.exports.clearCache = clearCache;","map":null,"metadata":{},"sourceType":"script"}